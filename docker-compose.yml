services:
  backend:
    build:
      context: ./backend
    container_name: lost-media-archive-backend
    environment:
      - PORT=3001
      - NODE_ENV=production
      - DATABASE_PATH=/app/data/media.db
      - FRONTEND_URL=http://localhost:8080
      - IPFS_GATEWAY=http://ipfs:8080
      - IPFS_API=/dns/ipfs/tcp/5001
    volumes:
      - backend-data:/app/data
    ports:
      - "3001:3001"
    depends_on:
      - ipfs

  frontend:
    build:
      context: ./frontend
    container_name: lost-media-archive-frontend
    ports:
      - "8080:80"
    depends_on:
      - backend

  ipfs:
    image: ipfs/kubo:latest
    container_name: lost-media-ipfs
    ports:
      - "5001:5001"  # API
      - "8081:8080"  # Gateway
      - "4001:4001"  # Swarm
    volumes:
      - ipfs-data:/data/ipfs

volumes:
  backend-data:
  ipfs-data:
